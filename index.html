<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Questing - Your Journey Begins</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Level up your life with daily quests and weekly challenges. Track your fitness, social, or career growth with gamified progress.">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Questing">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg-dark: #0f1419;
            --color-bg-medium: #1a2332;
            --color-bg-light: #2a3647;
            --color-primary: #3b82f6;
            --color-primary-light: #60a5fa;
            --color-secondary: #10b981;
            --color-accent: #06b6d4;
            --color-warning: #f59e0b;
            --color-danger: #ef4444;
            --color-text: #f1f5f9;
            --color-text-dim: #94a3b8;
            --color-text-muted: #64748b;
            --font-display: 'Outfit', sans-serif;
            --font-body: 'Inter', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, var(--color-bg-dark) 0%, var(--color-bg-medium) 50%, var(--color-bg-light) 100%);
            color: var(--color-text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.06) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            margin: 30px 0 20px;
            animation: fadeInDown 0.8s ease-out;
        }

        .title {
            font-family: var(--font-display);
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: 2px;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--color-text-dim);
            letter-spacing: 1px;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .screen.active {
            display: block;
        }

        .card {
            background: linear-gradient(135deg, rgba(26, 35, 50, 0.95) 0%, rgba(42, 54, 71, 0.9) 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }

        .card-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 1px;
        }

        .input-group {
            margin: 20px 0;
        }

        label {
            display: block;
            font-size: 1rem;
            color: var(--color-text-dim);
            margin-bottom: 8px;
            font-weight: 600;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            font-family: var(--font-body);
            font-size: 1rem;
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            color: var(--color-text);
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .goal-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .goal-option {
            background: linear-gradient(135deg, rgba(42, 54, 71, 0.4) 0%, rgba(26, 35, 50, 0.6) 100%);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .goal-option:hover {
            border-color: var(--color-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.2);
        }

        .goal-option.selected {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(6, 182, 212, 0.2) 100%);
            border-color: var(--color-primary);
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        .goal-icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .goal-content h3 {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 4px;
        }

        .goal-content p {
            font-size: 0.9rem;
            color: var(--color-text-dim);
            line-height: 1.4;
        }

        .btn {
            width: 100%;
            padding: 16px;
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .character-reveal {
            text-align: center;
            padding: 15px;
        }

        .class-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            color: white;
            padding: 10px 24px;
            border-radius: 50px;
            font-family: var(--font-display);
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 1px;
            margin: 15px 0;
            box-shadow: 0 5px 30px rgba(59, 130, 246, 0.4);
        }

        .class-description {
            font-size: 1rem;
            line-height: 1.6;
            color: var(--color-text-dim);
            margin: 15px 0;
        }

        .avatar-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }

        .avatar-wrapper {
            position: relative;
            flex-shrink: 0;
        }

        .avatar {
            width: 100px;
            height: 100px;
            position: relative;
        }

        .avatar-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.3) 0%, transparent 70%);
            animation: avatarPulse 3s ease-in-out infinite;
        }

        @keyframes avatarPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.5; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.8; }
        }

        .avatar-stats {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stat-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-mini {
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 10px;
            padding: 8px 16px;
            flex: 1;
        }

        .stat-mini-label {
            font-size: 0.75rem;
            color: var(--color-text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
            font-weight: 500;
        }

        .stat-mini-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--color-primary);
            font-weight: 800;
        }

        .evolution-mini {
            font-size: 0.8rem;
            color: var(--color-text-dim);
            margin-top: 2px;
        }

        .evolution-mini strong {
            color: var(--color-primary);
            font-weight: 600;
        }

        .xp-bar-container {
            margin: 15px 0;
        }

        .xp-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.85rem;
            color: var(--color-text-dim);
        }

        .xp-bar {
            height: 24px;
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-primary) 0%, var(--color-accent) 100%);
            transition: width 0.5s ease;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.5);
        }

        .quest-section {
            margin: 20px 0;
        }

        .section-header {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 10px;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-quest-icon {
            width: 28px;
            height: 28px;
            background: var(--color-secondary);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            margin-left: auto;
            line-height: 1;
            padding: 0;
        }

        .add-quest-icon:hover {
            background: #059669;
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }

        .quest-item {
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            padding: 12px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .quest-item:hover {
            border-color: var(--color-primary);
            transform: translateX(5px);
        }

        .quest-item.completed {
            opacity: 0.7;
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--color-secondary);
        }

        .quest-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(59, 130, 246, 0.4);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .quest-item.completed .quest-checkbox {
            background: var(--color-secondary);
            border-color: var(--color-secondary);
        }

        .quest-checkbox::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .quest-item.completed .quest-checkbox::after {
            opacity: 1;
            transform: scale(1);
        }

        .quest-content {
            flex: 1;
            min-width: 0;
        }

        .quest-title {
            font-size: 0.95rem;
            color: var(--color-text);
            font-weight: 500;
        }

        .quest-reward {
            font-size: 0.8rem;
            color: var(--color-primary);
            font-weight: 600;
            white-space: nowrap;
            margin-left: auto;
            padding-left: 10px;
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .celebration.active {
            display: flex;
        }

        .celebration-content {
            background: linear-gradient(135deg, var(--color-bg-medium) 0%, var(--color-bg-dark) 100%);
            border: 2px solid var(--color-primary);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
            animation: celebrationPop 0.5s ease-out;
        }

        @keyframes celebrationPop {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }

        .celebration-title {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--color-primary);
            margin-bottom: 20px;
        }

        .celebration-message {
            font-size: 1.15rem;
            color: var(--color-text);
            line-height: 1.6;
            margin-bottom: 25px;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .reset-btn {
            background: rgba(239, 68, 68, 0.15);
            border: 2px solid var(--color-danger);
            color: var(--color-danger);
            padding: 12px 24px;
            margin-top: 20px;
            font-weight: 600;
        }

        .reset-btn:hover {
            background: rgba(239, 68, 68, 0.25);
            box-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        .quest-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .quest-item:hover .quest-actions {
            opacity: 1;
        }

        .quest-item.completed:hover .quest-actions {
            opacity: 0.6;
        }

        .quest-delete {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.2rem;
            padding: 0;
            line-height: 1;
        }

        .quest-delete:hover {
            color: var(--color-danger);
            transform: scale(1.2);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, var(--color-bg-medium) 0%, var(--color-bg-dark) 100%);
            border: 2px solid var(--color-primary);
            border-radius: 16px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .modal-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--color-text);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 0.9rem;
            color: var(--color-text-dim);
            margin-bottom: 6px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            background: rgba(15, 20, 25, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            color: var(--color-text);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .reward-unlocked {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--color-secondary) !important;
        }

        .reward-ready {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--color-warning) !important;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            color: white;
        }

        .modal-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.4);
        }

        .modal-btn.secondary {
            background: rgba(100, 116, 139, 0.3);
            color: var(--color-text);
            border: 2px solid rgba(100, 116, 139, 0.5);
        }

        .modal-btn.secondary:hover {
            background: rgba(100, 116, 139, 0.4);
        }

        .modal-content ul {
            list-style: none;
            padding-left: 0;
        }

        .modal-content ul li {
            padding-left: 24px;
            position: relative;
        }

        .modal-content ul li::before {
            content: '√ó';
            position: absolute;
            left: 0;
            color: var(--color-danger);
            font-size: 1.3rem;
            font-weight: bold;
        }

        @media (max-width: 600px) {
            .title {
                font-size: 2.5rem;
            }

            .card {
                padding: 20px;
            }
            
            .avatar-container {
                flex-direction: column;
                gap: 15px;
            }
            
            .avatar-stats {
                width: 100%;
            }
            
            .stat-mini-value {
                font-size: 1.3rem;
            }
            
            .quest-actions {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="stars" id="stars"></div>

    <div class="container">
        <div class="header">
            <h1 class="title">QUESTING</h1>
            <p class="subtitle">Level Up Your Life</p>
        </div>

        <!-- Character Creation Screen -->
        <div id="creation-screen" class="screen active">
            <div class="card">
                <h2 class="card-title">Create Your Avatar</h2>
                
                <div class="input-group">
                    <label for="hero-name">Your Name</label>
                    <input type="text" id="hero-name" placeholder="Enter your name">
                </div>

                <div class="input-group">
                    <label>Choose Your Path</label>
                    <div class="goal-grid">
                        <div class="goal-option" data-goal="fitness">
                            <div class="goal-icon">
                                <svg viewBox="0 0 100 100" style="width: 100%; height: 100%;">
                                    <!-- Hair -->
                                    <rect x="20" y="8" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="12" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="16" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="20" width="56" height="4" fill="#5a4a3a"/>
                                    <!-- Red headband for fitness -->
                                    <rect x="20" y="24" width="56" height="4" fill="#ef4444"/>
                                    <!-- Face -->
                                    <rect x="28" y="28" width="40" height="28" fill="#f0d9c0"/>
                                    <!-- Eyes -->
                                    <rect x="36" y="40" width="4" height="4" fill="#000"/>
                                    <rect x="56" y="40" width="4" height="4" fill="#000"/>
                                    <!-- Smile -->
                                    <rect x="44" y="52" width="8" height="4" fill="#000"/>
                                    <!-- Neck -->
                                    <rect x="40" y="56" width="16" height="8" fill="#f0d9c0"/>
                                    <!-- Body (Green for fitness) -->
                                    <rect x="28" y="64" width="40" height="24" fill="#10b981"/>
                                    <!-- Arms -->
                                    <rect x="20" y="68" width="8" height="16" fill="#10b981"/>
                                    <rect x="68" y="68" width="8" height="16" fill="#10b981"/>
                                    <!-- Hands -->
                                    <rect x="20" y="84" width="8" height="4" fill="#f0d9c0"/>
                                    <rect x="68" y="84" width="8" height="4" fill="#f0d9c0"/>
                                    <!-- Legs -->
                                    <rect x="36" y="88" width="8" height="16" fill="#4a4a4a"/>
                                    <rect x="52" y="88" width="8" height="16" fill="#4a4a4a"/>
                                    <!-- Shoes -->
                                    <rect x="32" y="104" width="12" height="4" fill="#2a2a2a"/>
                                    <rect x="52" y="104" width="12" height="4" fill="#2a2a2a"/>
                                </svg>
                            </div>
                            <div class="goal-content">
                                <h3>Fitness & Wellness</h3>
                                <p>Build strength, health, and physical appearance</p>
                            </div>
                        </div>
                        <div class="goal-option" data-goal="social">
                            <div class="goal-icon">
                                <svg viewBox="0 0 100 100" style="width: 100%; height: 100%;">
                                    <!-- Hair -->
                                    <rect x="20" y="8" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="12" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="16" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="20" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="24" width="56" height="4" fill="#5a4a3a"/>
                                    <!-- Face -->
                                    <rect x="28" y="28" width="40" height="28" fill="#f0d9c0"/>
                                    <!-- Simple eyes (same as fitness) -->
                                    <rect x="36" y="40" width="4" height="4" fill="#000"/>
                                    <rect x="56" y="40" width="4" height="4" fill="#000"/>
                                    <!-- Rosy cheeks -->
                                    <rect x="32" y="48" width="4" height="4" fill="#ffb3ba" opacity="0.6"/>
                                    <rect x="60" y="48" width="4" height="4" fill="#ffb3ba" opacity="0.6"/>
                                    <!-- Lipstick smile -->
                                    <rect x="44" y="52" width="8" height="4" fill="#ff6b9d"/>
                                    <!-- Neck -->
                                    <rect x="40" y="56" width="16" height="8" fill="#f0d9c0"/>
                                    <!-- Body (Purple for social) -->
                                    <rect x="28" y="64" width="40" height="24" fill="#8b5cf6"/>
                                    <!-- Gold accessories -->
                                    <rect x="36" y="68" width="4" height="4" fill="#ffd700"/>
                                    <rect x="56" y="68" width="4" height="4" fill="#ffd700"/>
                                    <!-- Arms -->
                                    <rect x="20" y="68" width="8" height="16" fill="#8b5cf6"/>
                                    <rect x="68" y="68" width="8" height="16" fill="#8b5cf6"/>
                                    <!-- Hands -->
                                    <rect x="20" y="84" width="8" height="4" fill="#f0d9c0"/>
                                    <rect x="68" y="84" width="8" height="4" fill="#f0d9c0"/>
                                    <!-- Legs -->
                                    <rect x="36" y="88" width="8" height="16" fill="#4a4a4a"/>
                                    <rect x="52" y="88" width="8" height="16" fill="#4a4a4a"/>
                                    <!-- Shoes -->
                                    <rect x="32" y="104" width="12" height="4" fill="#2a2a2a"/>
                                    <rect x="52" y="104" width="12" height="4" fill="#2a2a2a"/>
                                </svg>
                            </div>
                            <div class="goal-content">
                                <h3>Charm & Attractiveness</h3>
                                <p>Develop charisma, social skills, and presence</p>
                            </div>
                        </div>
                        <div class="goal-option" data-goal="career">
                            <div class="goal-icon">
                                <svg viewBox="0 0 100 100" style="width: 100%; height: 100%;">
                                    <!-- Hair -->
                                    <rect x="20" y="8" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="12" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="16" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="20" width="56" height="4" fill="#5a4a3a"/>
                                    <rect x="20" y="24" width="56" height="4" fill="#5a4a3a"/>
                                    <!-- Face -->
                                    <rect x="28" y="28" width="40" height="28" fill="#f0d9c0"/>
                                    <!-- Simple eyes (same as fitness) -->
                                    <rect x="36" y="40" width="4" height="4" fill="#000"/>
                                    <rect x="56" y="40" width="4" height="4" fill="#000"/>
                                    <!-- Smile -->
                                    <rect x="44" y="52" width="8" height="4" fill="#000"/>
                                    <!-- Neck -->
                                    <rect x="40" y="56" width="16" height="8" fill="#f0d9c0"/>
                                    <!-- Body (Blue for career) -->
                                    <rect x="28" y="64" width="40" height="24" fill="#3b82f6"/>
                                    <!-- Red tie -->
                                    <rect x="48" y="64" width="4" height="16" fill="#ef4444"/>
                                    <!-- Arms -->
                                    <rect x="20" y="68" width="8" height="16" fill="#3b82f6"/>
                                    <rect x="68" y="68" width="8" height="16" fill="#3b82f6"/>
                                    <!-- Hands -->
                                    <rect x="20" y="84" width="8" height="4" fill="#f0d9c0"/>
                                    <rect x="68" y="84" width="8" height="4" fill="#f0d9c0"/>
                                    <!-- Legs -->
                                    <rect x="36" y="88" width="8" height="16" fill="#4a4a4a"/>
                                    <rect x="52" y="88" width="8" height="16" fill="#4a4a4a"/>
                                    <!-- Shoes -->
                                    <rect x="32" y="104" width="12" height="4" fill="#2a2a2a"/>
                                    <rect x="52" y="104" width="12" height="4" fill="#2a2a2a"/>
                                </svg>
                            </div>
                            <div class="goal-content">
                                <h3>Professional Growth</h3>
                                <p>Advance your career and build expertise</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn" id="begin-quest" disabled>Begin Your Quest</button>
            </div>
        </div>

        <!-- Character Reveal Screen -->
        <div id="reveal-screen" class="screen">
            <div class="card">
                <div class="character-reveal">
                    <h2 class="card-title">Your Journey Begins</h2>
                    
                    <!-- Avatar Display -->
                    <div style="display: flex; justify-content: center; margin: 20px 0;">
                        <svg id="reveal-avatar" viewBox="0 0 100 100" style="width: 120px; height: 120px;">
                            <!-- Avatar will be populated by JavaScript -->
                        </svg>
                    </div>
                    
                    <p style="font-size: 1.2rem; margin: 20px 0;">
                        Welcome, <strong id="reveal-name" style="color: var(--color-primary);">Hero</strong>!
                    </p>
                    <div class="class-badge" id="class-badge">CHAMPION</div>
                    <p class="class-description" id="class-description"></p>
                    
                </div>
                <button class="btn" id="enter-realm">Start Your Journey</button>
            </div>
        </div>

        <!-- Main Quest Screen -->
        <div id="quest-screen" class="screen">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2 class="card-title" id="hero-title" style="margin: 0;">Hero's Journal</h2>
                    <button id="reset-journey" style="background: none; border: none; color: var(--color-text-muted); font-size: 0.75rem; padding: 4px 8px; cursor: pointer; text-decoration: underline; opacity: 0.6; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'; this.style.color='var(--color-danger)'" onmouseout="this.style.opacity='0.6'; this.style.color='var(--color-text-muted)'">Reset Journey</button>
                </div>
                
                <div class="avatar-container">
                    <div class="avatar-wrapper">
                        <div class="avatar-glow"></div>
                        <svg class="avatar" id="hero-avatar" viewBox="0 0 200 200">
                            <!-- Avatar will be generated by JavaScript -->
                        </svg>
                    </div>
                    
                    <div class="avatar-stats">
                        <!-- Evolution text above both boxes -->
                        <div id="evolution-indicator" class="evolution-mini" style="margin: 0 0 8px 0; text-align: center;">
                            <!-- Evolution progress will be shown here -->
                        </div>
                        
                        <div class="stat-row" style="align-items: stretch;">
                            <!-- Level box on left - with Rank inside dotted border -->
                            <div class="stat-mini" style="flex: 0.6; display: flex; flex-direction: column; justify-content: center; align-items: center;">
                                <div class="stat-mini-label">Level</div>
                                <div class="stat-mini-value" id="level">1</div>
                                <!-- Rank with dotted border -->
                                <div style="margin-top: 8px; padding: 6px 10px; border: 2px dotted rgba(59, 130, 246, 0.5); border-radius: 6px;">
                                    <div id="rank" style="font-size: 0.7rem; font-weight: 600; color: var(--color-text); text-align: center; line-height: 1.2;">Beginner</div>
                                </div>
                            </div>
                            
                            <!-- Right column: Class box + Set Rewards button -->
                            <div style="flex: 1.4; display: flex; flex-direction: column; gap: 8px;">
                                <div class="stat-mini" style="flex: 1; padding: 14px 16px; display: flex; flex-direction: column; justify-content: center;">
                                    <div class="stat-mini-label">Class</div>
                                    <div class="stat-mini-value" id="class" style="font-size: 1rem;">Champion</div>
                                </div>
                                <button class="btn" id="set-rewards-btn" style="padding: 14px 16px; font-size: 0.85rem; background: var(--color-primary); width: 100%;">Set Rewards</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="xp-bar-container">
                    <div class="xp-label">
                        <span>Experience</span>
                        <span id="xp-text">0 / 100</span>
                    </div>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="quest-section">
                    <h3 class="section-header">
                        Daily Quests
                        <button class="add-quest-icon" onclick="addNewQuest('daily')" title="Add custom quest">+</button>
                    </h3>
                    <div id="daily-quests"></div>
                </div>

                <div class="quest-section">
                    <h3 class="section-header">
                        Weekly Challenges
                        <button class="add-quest-icon" onclick="addNewQuest('weekly')" title="Add custom challenge">+</button>
                    </h3>
                    <div id="weekly-quests"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- Celebration Modal -->
    <div class="celebration" id="celebration">
        <div class="celebration-content">
            <h2 class="celebration-title" id="celebration-title">Victory!</h2>
            <p class="celebration-message" id="celebration-message"></p>
            <button class="btn" id="celebration-close">Continue</button>
        </div>
    </div>

    <!-- Evolution Intro Modal -->
    <div class="celebration" id="evolution-intro">
        <div class="celebration-content">
            <h2 class="celebration-title" style="color: var(--color-primary);">üåü Your Journey Begins!</h2>
            <p class="celebration-message" style="font-size: 1rem; line-height: 1.6; margin: 20px 0 15px 0;">
                Your avatar will now start from <strong>beginner form</strong> and will evolve as you level up towards your chosen path.
            </p>
            
            <!-- Evolution Preview Visual -->
            <div style="display: flex; align-items: center; justify-content: center; gap: 20px; margin: 25px 0; padding: 20px; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
                <!-- Beginner Avatar -->
                <div style="text-align: center;">
                    <svg viewBox="0 0 100 120" style="width: 80px; height: 96px;">
                        <!-- Hair -->
                        <rect x="20" y="8" width="56" height="4" fill="#5a4a3a"/>
                        <rect x="20" y="12" width="56" height="4" fill="#5a4a3a"/>
                        <rect x="20" y="16" width="56" height="4" fill="#5a4a3a"/>
                        <rect x="20" y="20" width="56" height="4" fill="#5a4a3a"/>
                        <rect x="20" y="24" width="56" height="4" fill="#5a4a3a"/>
                        <!-- Face -->
                        <rect x="28" y="28" width="40" height="28" fill="#f0d9c0"/>
                        <!-- Eyes -->
                        <rect x="36" y="40" width="4" height="4" fill="#000"/>
                        <rect x="56" y="40" width="4" height="4" fill="#000"/>
                        <!-- Smile -->
                        <rect x="44" y="52" width="8" height="4" fill="#000"/>
                        <!-- Neck -->
                        <rect x="40" y="56" width="16" height="8" fill="#f0d9c0"/>
                        <!-- Body (Gray beginner) -->
                        <rect x="28" y="64" width="40" height="24" fill="#94a3b8"/>
                        <!-- Arms -->
                        <rect x="20" y="68" width="8" height="16" fill="#94a3b8"/>
                        <rect x="68" y="68" width="8" height="16" fill="#94a3b8"/>
                        <!-- Hands -->
                        <rect x="20" y="84" width="8" height="4" fill="#f0d9c0"/>
                        <rect x="68" y="84" width="8" height="4" fill="#f0d9c0"/>
                        <!-- Legs -->
                        <rect x="36" y="88" width="8" height="16" fill="#4a4a4a"/>
                        <rect x="52" y="88" width="8" height="16" fill="#4a4a4a"/>
                        <!-- Shoes -->
                        <rect x="32" y="104" width="12" height="4" fill="#2a2a2a"/>
                        <rect x="52" y="104" width="12" height="4" fill="#2a2a2a"/>
                    </svg>
                    <div style="font-size: 0.85rem; font-weight: 600; color: var(--color-text-dim); margin-top: 8px;">Beginner</div>
                </div>
                
                <!-- Arrow -->
                <div style="font-size: 2rem; color: var(--color-primary);">‚Üí</div>
                
                <!-- Mystery Apprentice Avatar -->
                <div style="text-align: center;">
                    <svg viewBox="0 0 100 120" style="width: 80px; height: 96px;">
                        <!-- Outline of avatar with dashed border effect -->
                        <rect x="20" y="8" width="56" height="4" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="20" y="12" width="56" height="12" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="28" y="28" width="40" height="28" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="40" y="56" width="16" height="8" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="28" y="64" width="40" height="24" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="20" y="68" width="8" height="16" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="68" y="68" width="8" height="16" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="36" y="88" width="8" height="16" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <rect x="52" y="88" width="8" height="16" fill="none" stroke="var(--color-primary)" stroke-width="2" stroke-dasharray="4,2" opacity="0.5"/>
                        <!-- Question mark -->
                        <text x="48" y="60" text-anchor="middle" font-family="Outfit, sans-serif" font-size="28" font-weight="700" fill="var(--color-primary)">?</text>
                    </svg>
                    <div style="font-size: 0.85rem; font-weight: 600; color: var(--color-primary); margin-top: 8px;">Apprentice</div>
                </div>
            </div>
            
            <p class="celebration-message" style="font-size: 1rem; line-height: 1.6; margin: 15px 0 20px 0;">
                Watch your evolution as you complete your daily and weekly tasks! üöÄ
            </p>
            <button class="btn" id="evolution-intro-close">Got It!</button>
        </div>
    </div>

    <!-- Quest Edit Modal -->
    <div class="modal" id="quest-modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-title">Edit Quest</h3>
            <div class="form-group">
                <label for="quest-title-input">Quest Title</label>
                <input type="text" id="quest-title-input" placeholder="Enter your custom task">
            </div>
            <div class="form-group">
                <label for="quest-xp-input">XP Reward</label>
                <input type="number" id="quest-xp-input" placeholder="20" min="1">
            </div>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="modal-cancel">Cancel</button>
                <button class="modal-btn primary" id="modal-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Rewards Modal -->
    <div class="modal" id="rewards-modal">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="modal-title">üèÜ Evolution Rewards</h3>
            <p style="font-size: 0.9rem; color: var(--color-text-dim); margin-bottom: 20px;">
                Track and edit your milestone rewards. Unlocked rewards are highlighted!
            </p>
            
            <div class="form-group">
                <label for="reward-stage2">
                    <span id="reward-status-2" style="font-weight: 700;"></span> Level 5 Reward (Apprentice)
                </label>
                <input type="text" id="reward-stage2" placeholder="e.g., A meal treat from my accountability partner">
            </div>
            <div class="form-group">
                <label for="reward-stage3">
                    <span id="reward-status-3" style="font-weight: 700;"></span> Level 10 Reward (Warrior)
                </label>
                <input type="text" id="reward-stage3" placeholder="e.g., Purchase that bag I've been wanting">
            </div>
            <div class="form-group">
                <label for="reward-stage4">
                    <span id="reward-status-4" style="font-weight: 700;"></span> Level 15 Reward (Master)
                </label>
                <input type="text" id="reward-stage4" placeholder="e.g., A spa day or massage">
            </div>
            <div class="form-group">
                <label for="reward-stage5">
                    <span id="reward-status-5" style="font-weight: 700;"></span> Level 20 Reward (Legend)
                </label>
                <input type="text" id="reward-stage5" placeholder="e.g., Book a holiday or weekend getaway">
            </div>
            
            <div class="modal-actions">
                <button class="modal-btn secondary" id="rewards-cancel">Cancel</button>
                <button class="modal-btn primary" id="rewards-save">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Reward Claim Modal -->
    <div class="modal" id="reward-claim-modal">
        <div class="modal-content">
            <h3 class="modal-title">üéâ Evolution Reward Unlocked! üéâ</h3>
            <p style="font-size: 1.1rem; color: var(--color-text); margin: 20px 0; line-height: 1.6;" id="reward-claim-text"></p>
            <p style="font-size: 0.9rem; color: var(--color-text-dim); margin-bottom: 20px;">
                You've earned this reward! Go claim it!
            </p>
            <button class="btn" id="reward-claim-close">Awesome!</button>
        </div>
    </div>

    <!-- Reset Confirmation Modal -->
    <div class="modal" id="reset-confirm-modal">
        <div class="modal-content">
            <h3 class="modal-title" style="color: var(--color-danger);">‚ö†Ô∏è Reset Journey?</h3>
            <p style="font-size: 1rem; color: var(--color-text); margin: 20px 0; line-height: 1.6;">
                Are you sure you want to start over? This will permanently delete:
            </p>
            <ul style="text-align: left; color: var(--color-text-dim); margin: 15px 0; line-height: 1.8;">
                <li>All your progress and levels</li>
                <li>Completed quests and XP</li>
                <li>Custom quests you created</li>
                <li>Your reward settings</li>
            </ul>
            <p style="font-size: 0.9rem; color: var(--color-danger); margin-bottom: 20px; font-weight: 600;">
                This action cannot be undone!
            </p>
            <div class="modal-actions">
                <button class="modal-btn secondary" id="reset-cancel">Cancel</button>
                <button class="modal-btn primary" id="reset-confirm" style="background: var(--color-danger);">Reset Everything</button>
            </div>
        </div>
    </div>

    <!-- Delete Quest Confirmation Modal -->
    <div class="modal" id="delete-quest-modal">
        <div class="modal-content">
            <h3 class="modal-title" style="color: var(--color-primary);">Remove this quest?</h3>
            <div class="modal-actions" style="margin-top: 30px;">
                <button class="modal-btn secondary" id="delete-quest-no">No</button>
                <button class="modal-btn primary" id="delete-quest-yes" style="background: var(--color-primary);">Yes</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        let gameState = {
            name: '',
            goal: '',
            class: '',
            level: 1,
            xp: 0,
            xpNeeded: 100,
            dailyQuests: [],
            weeklyQuests: [],
            completedQuests: [],
            lastReset: new Date().toDateString(),
            rewards: {
                stage2: '', // Level 5 reward
                stage3: '', // Level 10 reward
                stage4: '', // Level 15 reward
                stage5: ''  // Level 20 reward
            },
            claimedRewards: []
        };

        // Quest Templates
        const questTemplates = {
            fitness: {
                daily: [
                    { title: 'Walk 8000 steps', xp: 30 },
                    { title: 'Drink 8 glasses of water', xp: 20 },
                    { title: 'Eat 4 vegetables/fruits servings', xp: 20 },
                    { title: 'Get 7-8h sleep last night', xp: 25 }
                ],
                weekly: [
                    { title: 'Exercise 3 times this week', xp: 120 },
                    { title: 'Limit sugary drinks to 2x this week', xp: 80 },
                    { title: 'Take the stairs 4x a week', xp: 75 }
                ]
            },
            social: {
                daily: [
                    { title: 'Speak confidently', xp: 25 },
                    { title: 'Give someone a genuine compliment', xp: 20 },
                    { title: 'Practice active listening', xp: 20 },
                    { title: 'Dress well and neatly', xp: 25 }
                ],
                weekly: [
                    { title: 'Show your love to your loved ones', xp: 100 },
                    { title: "Don't gossip/speak badly about others", xp: 90 },
                    { title: 'Have deep conversations with 2 people', xp: 80 }
                ]
            },
            career: {
                daily: [
                    { title: 'Work on skill development for 30 min', xp: 30 },
                    { title: 'Read industry news or articles', xp: 20 },
                    { title: 'Network with a professional contact', xp: 25 },
                    { title: 'Update your task priorities', xp: 20 }
                ],
                weekly: [
                    { title: 'Get feedback from people you work with', xp: 100 },
                    { title: 'Work on a side project for 3 hours', xp: 120 },
                    { title: 'Do self reflection', xp: 80 }
                ]
            }
        };

        // Class Information
        const classInfo = {
            fitness: {
                name: 'FITNESS CHAMPION',
                description: 'You are dedicated to building a strong, healthy body and maintaining peak physical condition. Through consistent effort, you will transform yourself inside and out.'
            },
            social: {
                name: 'CHARM MASTER',
                description: 'You are focused on developing magnetic charisma and social confidence. Your journey will enhance your presence and create meaningful connections with others.'
            },
            career: {
                name: 'CAREER ACHIEVER',
                description: 'You are committed to professional excellence and continuous growth. Through learning and dedication, you will reach new heights in your career.'
            }
        };

        // Celebration Messages
        const messages = {
            allDaily: [
                'All Daily Quests Complete! Amazing consistency!',
                'Daily Goals Achieved! You\'re building great habits!',
                'Perfect Day! All daily quests completed!',
                'Excellent work! Daily quest streak complete!',
                'Daily Victory! Keep up the momentum!'
            ],
            allWeekly: [
                'All Weekly Challenges Complete! Outstanding dedication!',
                'Weekly Goals Crushed! You\'re unstoppable!',
                'Perfect Week! All challenges conquered!',
                'Incredible! All weekly quests done!',
                'Weekly Victory! You\'re a true champion!'
            ],
            levelUp: [
                'Level Up! You\'ve reached level {level}!',
                'Congratulations! Welcome to level {level}.',
                'Amazing progress! You\'re now level {level}!',
                'You\'ve leveled up! Now at level {level}.',
                'Outstanding! Level {level} achieved!'
            ],
            milestones: {
                5: 'You\'re building consistency! Keep it up.',
                10: 'Double digits! You\'re on a roll.',
                15: 'Impressive dedication. You\'re crushing it!',
                20: 'Level 20! You\'re a true champion!'
            }
        };

        // Generate Avatar
        function generateAvatar(level) {
            const avatar = document.getElementById('hero-avatar');
            if (!avatar) return;
            
            // Determine avatar stage based on level
            let stage = 1;
            if (level >= 20) stage = 5;
            else if (level >= 15) stage = 4;
            else if (level >= 10) stage = 3;
            else if (level >= 5) stage = 2;
            
            // Get the user's chosen path
            const path = gameState.goal || 'fitness';
            
            // Path-specific color schemes for different stages
            const colorSchemes = {
                fitness: [
                    { primary: '#94a3b8', secondary: '#64748b', accent: '#3b82f6', skin: '#f0d9c0' }, // Stage 1: Gray beginner
                    { primary: '#6ee7b7', secondary: '#34d399', accent: '#10b981', skin: '#f0d9c0' }, // Stage 2: Light Green
                    { primary: '#34d399', secondary: '#10b981', accent: '#059669', skin: '#f0d9c0' }, // Stage 3: Green
                    { primary: '#14b8a6', secondary: '#0d9488', accent: '#0f766e', skin: '#f0d9c0' }, // Stage 4: Teal
                    { primary: '#fbbf24', secondary: '#f59e0b', accent: '#d97706', skin: '#f0d9c0' }  // Stage 5: Gold
                ],
                social: [
                    { primary: '#94a3b8', secondary: '#64748b', accent: '#3b82f6', skin: '#f0d9c0' }, // Stage 1: Gray beginner
                    { primary: '#c4b5fd', secondary: '#a78bfa', accent: '#8b5cf6', skin: '#f0d9c0' }, // Stage 2: Light Purple
                    { primary: '#a78bfa', secondary: '#8b5cf6', accent: '#7c3aed', skin: '#f0d9c0' }, // Stage 3: Purple
                    { primary: '#d946ef', secondary: '#c026d3', accent: '#a21caf', skin: '#f0d9c0' }, // Stage 4: Fuchsia
                    { primary: '#fbbf24', secondary: '#f59e0b', accent: '#d97706', skin: '#f0d9c0' }  // Stage 5: Gold
                ],
                career: [
                    { primary: '#94a3b8', secondary: '#64748b', accent: '#3b82f6', skin: '#f0d9c0' }, // Stage 1: Gray beginner
                    { primary: '#93c5fd', secondary: '#60a5fa', accent: '#3b82f6', skin: '#f0d9c0' }, // Stage 2: Light Blue
                    { primary: '#60a5fa', secondary: '#3b82f6', accent: '#2563eb', skin: '#f0d9c0' }, // Stage 3: Blue
                    { primary: '#3b82f6', secondary: '#2563eb', accent: '#1d4ed8', skin: '#f0d9c0' }, // Stage 4: Deep Blue
                    { primary: '#fbbf24', secondary: '#f59e0b', accent: '#d97706', skin: '#f0d9c0' }  // Stage 5: Gold
                ]
            };
            
            const color = colorSchemes[path][stage - 1];
            const pixelSize = 4;
            
            // Helper function to create pixel
            const pixel = (x, y, fill, opacity = 1) => 
                `<rect x="${x * pixelSize}" y="${y * pixelSize}" width="${pixelSize}" height="${pixelSize}" fill="${fill}" opacity="${opacity}"/>`;
            
            let pixels = '';
            
            // Hair
            for (let x = 5; x < 20; x++) {
                for (let y = 2; y < 8; y++) {
                    if ((x >= 6 && x <= 18 && y >= 3 && y <= 7) || 
                        (x >= 7 && x <= 17 && y >= 2 && y <= 3)) {
                        pixels += pixel(x, y, '#5a4a3a');
                    }
                }
            }
            
            // Face outline (skin)
            for (let x = 7; x < 17; x++) {
                for (let y = 8; y < 16; y++) {
                    if (x >= 8 && x <= 15) {
                        pixels += pixel(x, y, color.skin);
                    }
                }
            }
            
            // Eyes
            pixels += pixel(9, 10, '#000000');
            pixels += pixel(14, 10, '#000000');
            
            // Path-specific facial features
            if (path === 'social') {
                // Rosy cheeks appear at Apprentice stage (stage 2+)
                if (stage >= 2) {
                    pixels += pixel(8, 12, '#ffb3ba', 0.6);
                    pixels += pixel(15, 12, '#ffb3ba', 0.6);
                }
                // Lipstick smile appears at Warrior stage (stage 3+)
                if (stage >= 3) {
                    pixels += pixel(11, 13, '#ff6b9d');
                    pixels += pixel(12, 13, '#ff6b9d');
                } else {
                    // Regular smile before Warrior
                    pixels += pixel(11, 13, '#000000');
                }
            } else {
                // Regular smile for fitness and career paths
                pixels += pixel(11, 13, '#000000');
                if (stage >= 3) {
                    pixels += pixel(12, 13, '#000000');
                }
            }
            
            // Body (outfit color changes with stage)
            for (let x = 6; x < 18; x++) {
                for (let y = 16; y < 24; y++) {
                    if (x >= 7 && x <= 16) {
                        pixels += pixel(x, y, color.primary);
                    }
                }
            }
            
            // Path-specific body details
            if (path === 'career' && stage >= 3) {
                // Red tie appears at Warrior stage
                pixels += pixel(11, 17, '#ef4444');
                pixels += pixel(12, 17, '#ef4444');
                pixels += pixel(11, 18, '#ef4444');
                pixels += pixel(12, 18, '#ef4444');
                pixels += pixel(11, 19, '#ef4444');
                pixels += pixel(12, 19, '#ef4444');
            }
            
            if (path === 'social' && stage >= 3) {
                // Gold accessories appear at Warrior stage
                pixels += pixel(9, 17, '#ffd700');
                pixels += pixel(14, 17, '#ffd700');
            }
            
            if (path === 'fitness' && stage >= 3) {
                // Red headband appears at Warrior stage
                for (let x = 5; x < 19; x++) {
                    pixels += pixel(x, 7, '#ef4444');
                }
            }
            
            // Master stage (stage 4) enhancements
            if (stage >= 4) {
                if (path === 'fitness') {
                    // Muscle definition for fitness
                    pixels += pixel(7, 17, color.secondary);
                    pixels += pixel(16, 17, color.secondary);
                    // Dumbbell in hand
                    pixels += pixel(3, 21, '#4a4a4a');
                    pixels += pixel(4, 21, '#4a4a4a');
                    pixels += pixel(3, 22, '#2a2a2a');
                    pixels += pixel(4, 22, '#2a2a2a');
                    pixels += pixel(5, 22, '#2a2a2a');
                    pixels += pixel(6, 22, '#2a2a2a');
                    pixels += pixel(3, 23, '#4a4a4a');
                    pixels += pixel(4, 23, '#4a4a4a');
                }
                
                if (path === 'social') {
                    // Red handbag
                    pixels += pixel(19, 21, '#ef4444');
                    pixels += pixel(20, 21, '#ef4444');
                    pixels += pixel(19, 22, '#ef4444');
                    pixels += pixel(20, 22, '#ef4444');
                    pixels += pixel(19, 23, '#dc2626');
                    pixels += pixel(20, 23, '#dc2626');
                    // Bag strap
                    pixels += pixel(19, 20, '#dc2626');
                }
                
                if (path === 'career') {
                    // Professional briefcase
                    pixels += pixel(19, 22, '#3a2a1a');
                    pixels += pixel(20, 22, '#3a2a1a');
                    pixels += pixel(21, 22, '#3a2a1a');
                    pixels += pixel(19, 23, '#3a2a1a');
                    pixels += pixel(20, 23, '#3a2a1a');
                    pixels += pixel(21, 23, '#3a2a1a');
                    pixels += pixel(19, 24, '#2a1a0a');
                    pixels += pixel(20, 24, '#2a1a0a');
                    pixels += pixel(21, 24, '#2a1a0a');
                    // Briefcase handle
                    pixels += pixel(20, 21, '#ffd700');
                }
            }
            
            // Body detail stripe
            for (let x = 9; x < 15; x++) {
                pixels += pixel(x, 17, color.secondary);
            }
            
            // Arms
            for (let y = 17; y < 22; y++) {
                pixels += pixel(5, y, color.primary);
                pixels += pixel(18, y, color.primary);
            }
            
            // Hands
            pixels += pixel(5, 22, color.skin);
            pixels += pixel(18, 22, color.skin);
            
            // Legs
            for (let y = 24; y < 30; y++) {
                pixels += pixel(9, y, '#4a4a4a');
                pixels += pixel(10, y, '#4a4a4a');
                pixels += pixel(13, y, '#4a4a4a');
                pixels += pixel(14, y, '#4a4a4a');
            }
            
            // Shoes
            for (let x = 8; x < 12; x++) {
                pixels += pixel(x, 30, '#2a2a2a');
            }
            for (let x = 12; x < 16; x++) {
                pixels += pixel(x, 30, '#2a2a2a');
            }
            
            // Legend stage (stage 5): Gold crown and sparkles!
            if (stage >= 5) {
                // Large gold crown
                pixels += pixel(10, 1, '#fbbf24');
                pixels += pixel(11, 1, '#fbbf24');
                pixels += pixel(12, 1, '#fbbf24');
                pixels += pixel(13, 1, '#fbbf24');
                pixels += pixel(10, 2, '#f59e0b');
                pixels += pixel(11, 2, '#fbbf24');
                pixels += pixel(12, 2, '#fbbf24');
                pixels += pixel(13, 2, '#f59e0b');
                // Sparkles around avatar
                pixels += pixel(3, 8, '#fbbf24', 0.8);
                pixels += pixel(20, 8, '#fbbf24', 0.8);
                pixels += pixel(2, 15, '#fbbf24', 0.8);
                pixels += pixel(21, 15, '#fbbf24', 0.8);
                pixels += pixel(4, 20, '#fbbf24', 0.6);
                pixels += pixel(19, 20, '#fbbf24', 0.6);
            }
            
            // Level badge
            const badgeX = 18;
            const badgeY = 3;
            for (let x = badgeX; x < badgeX + 4; x++) {
                for (let y = badgeY; y < badgeY + 4; y++) {
                    pixels += pixel(x, y, color.accent);
                }
            }
            
            avatar.innerHTML = `
                <g transform="translate(75, 10)">
                    ${pixels}
                    <text x="${(badgeX + 2) * pixelSize}" y="${(badgeY + 2.8) * pixelSize}" 
                          text-anchor="middle" 
                          font-family="Outfit, sans-serif" 
                          font-size="10" 
                          font-weight="700" 
                          fill="white">${level}</text>
                </g>
            `;
            
            // Update evolution indicator
            updateEvolutionIndicator(level, stage);
        }
        
        // Update Evolution Indicator
        function updateEvolutionIndicator(level, stage) {
            const indicator = document.getElementById('evolution-indicator');
            if (!indicator) return;
            
            const stageThresholds = [1, 5, 10, 15, 20];
            const stageNames = ['Beginner', 'Apprentice', 'Warrior', 'Master', 'Legend'];
            
            if (stage === 5) {
                indicator.innerHTML = `
                    <span style="color: var(--color-warning);">‚≠ê Max Evolution!</span>
                `;
            } else {
                const nextThreshold = stageThresholds[stage];
                const levelsToGo = nextThreshold - level;
                
                indicator.innerHTML = `
                    <strong>${levelsToGo} more level${levelsToGo !== 1 ? 's' : ''}</strong> to evolve your avatar
                `;
            }
        }

        // Initialize Stars
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

        // Load Game State
        function loadGameState() {
            const saved = localStorage.getItem('questing_state');
            if (saved) {
                gameState = JSON.parse(saved);
                checkDailyReset();
                return true;
            }
            return false;
        }

        // Save Game State
        function saveGameState() {
            localStorage.setItem('questing_state', JSON.stringify(gameState));
        }

        // Check if daily reset is needed
        function checkDailyReset() {
            const today = new Date().toDateString();
            if (gameState.lastReset !== today) {
                // Reset daily quest completion status (preserve custom quests!)
                if (gameState.dailyQuests) {
                    gameState.dailyQuests.forEach(quest => {
                        quest.completed = false;
                    });
                }
                
                // Check for weekly reset (only on Mondays)
                const currentDate = new Date();
                if (currentDate.getDay() === 1) {
                    // Reset weekly quest completion status (preserve custom quests!)
                    if (gameState.weeklyQuests) {
                        gameState.weeklyQuests.forEach(quest => {
                            quest.completed = false;
                        });
                    }
                }
                
                gameState.lastReset = today;
                saveGameState();
            }
        }

        // Generate Quests
        function generateQuests(type) {
            const templates = questTemplates[gameState.goal][type];
            return templates.map((quest, index) => ({
                id: `${type}-${index}-${Date.now()}`,
                ...quest,
                completed: false,
                type: type
            }));
        }

        // Show Screen
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            window.scrollTo(0, 0); // Scroll to top when changing screens
        }

        // Goal Selection
        document.querySelectorAll('.goal-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.goal-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                gameState.goal = option.dataset.goal;
                document.getElementById('begin-quest').disabled = !document.getElementById('hero-name').value.trim();
            });
        });

        // Name Input
        document.getElementById('hero-name').addEventListener('input', (e) => {
            gameState.name = e.target.value.trim();
            document.getElementById('begin-quest').disabled = !gameState.name || !gameState.goal;
        });

        // Generate Reveal Avatar
        function generateRevealAvatar(goal) {
            const avatar = document.getElementById('reveal-avatar');
            if (!avatar) return;
            
            const avatarSVGs = {
                fitness: `
                    <!-- Hair -->
                    <rect x="20" y="8" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="12" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="16" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="20" width="56" height="4" fill="#5a4a3a"/>
                    <!-- Red headband for fitness -->
                    <rect x="20" y="24" width="56" height="4" fill="#ef4444"/>
                    <!-- Face -->
                    <rect x="28" y="28" width="40" height="28" fill="#f0d9c0"/>
                    <!-- Eyes -->
                    <rect x="36" y="40" width="4" height="4" fill="#000"/>
                    <rect x="56" y="40" width="4" height="4" fill="#000"/>
                    <!-- Smile -->
                    <rect x="44" y="52" width="8" height="4" fill="#000"/>
                    <!-- Neck -->
                    <rect x="40" y="56" width="16" height="8" fill="#f0d9c0"/>
                    <!-- Body (Green for fitness) -->
                    <rect x="28" y="64" width="40" height="24" fill="#10b981"/>
                    <!-- Arms -->
                    <rect x="20" y="68" width="8" height="16" fill="#10b981"/>
                    <rect x="68" y="68" width="8" height="16" fill="#10b981"/>
                    <!-- Hands -->
                    <rect x="20" y="84" width="8" height="4" fill="#f0d9c0"/>
                    <rect x="68" y="84" width="8" height="4" fill="#f0d9c0"/>
                    <!-- Legs -->
                    <rect x="36" y="88" width="8" height="16" fill="#4a4a4a"/>
                    <rect x="52" y="88" width="8" height="16" fill="#4a4a4a"/>
                    <!-- Shoes -->
                    <rect x="32" y="104" width="12" height="4" fill="#2a2a2a"/>
                    <rect x="52" y="104" width="12" height="4" fill="#2a2a2a"/>
                `,
                social: `
                    <!-- Hair -->
                    <rect x="20" y="8" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="12" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="16" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="20" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="24" width="56" height="4" fill="#5a4a3a"/>
                    <!-- Face -->
                    <rect x="28" y="28" width="40" height="28" fill="#f0d9c0"/>
                    <!-- Simple eyes (same as fitness) -->
                    <rect x="36" y="40" width="4" height="4" fill="#000"/>
                    <rect x="56" y="40" width="4" height="4" fill="#000"/>
                    <!-- Rosy cheeks -->
                    <rect x="32" y="48" width="4" height="4" fill="#ffb3ba" opacity="0.6"/>
                    <rect x="60" y="48" width="4" height="4" fill="#ffb3ba" opacity="0.6"/>
                    <!-- Lipstick smile -->
                    <rect x="44" y="52" width="8" height="4" fill="#ff6b9d"/>
                    <!-- Neck -->
                    <rect x="40" y="56" width="16" height="8" fill="#f0d9c0"/>
                    <!-- Body (Purple for social) -->
                    <rect x="28" y="64" width="40" height="24" fill="#8b5cf6"/>
                    <!-- Gold accessories -->
                    <rect x="36" y="68" width="4" height="4" fill="#ffd700"/>
                    <rect x="56" y="68" width="4" height="4" fill="#ffd700"/>
                    <!-- Arms -->
                    <rect x="20" y="68" width="8" height="16" fill="#8b5cf6"/>
                    <rect x="68" y="68" width="8" height="16" fill="#8b5cf6"/>
                    <!-- Hands -->
                    <rect x="20" y="84" width="8" height="4" fill="#f0d9c0"/>
                    <rect x="68" y="84" width="8" height="4" fill="#f0d9c0"/>
                    <!-- Legs -->
                    <rect x="36" y="88" width="8" height="16" fill="#4a4a4a"/>
                    <rect x="52" y="88" width="8" height="16" fill="#4a4a4a"/>
                    <!-- Shoes -->
                    <rect x="32" y="104" width="12" height="4" fill="#2a2a2a"/>
                    <rect x="52" y="104" width="12" height="4" fill="#2a2a2a"/>
                `,
                career: `
                    <!-- Hair -->
                    <rect x="20" y="8" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="12" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="16" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="20" width="56" height="4" fill="#5a4a3a"/>
                    <rect x="20" y="24" width="56" height="4" fill="#5a4a3a"/>
                    <!-- Face -->
                    <rect x="28" y="28" width="40" height="28" fill="#f0d9c0"/>
                    <!-- Simple eyes (same as fitness) -->
                    <rect x="36" y="40" width="4" height="4" fill="#000"/>
                    <rect x="56" y="40" width="4" height="4" fill="#000"/>
                    <!-- Smile -->
                    <rect x="44" y="52" width="8" height="4" fill="#000"/>
                    <!-- Neck -->
                    <rect x="40" y="56" width="16" height="8" fill="#f0d9c0"/>
                    <!-- Body (Blue for career) -->
                    <rect x="28" y="64" width="40" height="24" fill="#3b82f6"/>
                    <!-- Red tie -->
                    <rect x="48" y="64" width="4" height="16" fill="#ef4444"/>
                    <!-- Arms -->
                    <rect x="20" y="68" width="8" height="16" fill="#3b82f6"/>
                    <rect x="68" y="68" width="8" height="16" fill="#3b82f6"/>
                    <!-- Hands -->
                    <rect x="20" y="84" width="8" height="4" fill="#f0d9c0"/>
                    <rect x="68" y="84" width="8" height="4" fill="#f0d9c0"/>
                    <!-- Legs -->
                    <rect x="36" y="88" width="8" height="16" fill="#4a4a4a"/>
                    <rect x="52" y="88" width="8" height="16" fill="#4a4a4a"/>
                    <!-- Shoes -->
                    <rect x="32" y="104" width="12" height="4" fill="#2a2a2a"/>
                    <rect x="52" y="104" width="12" height="4" fill="#2a2a2a"/>
                `
            };
            
            avatar.innerHTML = avatarSVGs[goal] || avatarSVGs.fitness;
        }

        // Begin Quest
        document.getElementById('begin-quest').addEventListener('click', () => {
            if (!gameState.name || !gameState.goal) return;
            
            gameState.class = classInfo[gameState.goal].name;
            gameState.dailyQuests = generateQuests('daily');
            gameState.weeklyQuests = generateQuests('weekly');
            gameState.lastReset = new Date().toDateString();
            
            document.getElementById('reveal-name').textContent = gameState.name;
            document.getElementById('class-badge').textContent = gameState.class;
            document.getElementById('class-description').textContent = classInfo[gameState.goal].description;
            generateRevealAvatar(gameState.goal);
            
            showScreen('reveal-screen');
            saveGameState();
        });

        // Enter Realm
        document.getElementById('enter-realm').addEventListener('click', () => {
            showScreen('quest-screen');
            renderQuestScreen();
            showEvolutionIntro();
        });

        // Render Quest Screen
        function renderQuestScreen() {
            document.getElementById('hero-title').textContent = `${gameState.name}'s Journal`;
            
            // Determine current stage
            let stage = 1;
            if (gameState.level >= 20) stage = 5;
            else if (gameState.level >= 15) stage = 4;
            else if (gameState.level >= 10) stage = 3;
            else if (gameState.level >= 5) stage = 2;
            const stageNames = ['Beginner', 'Apprentice', 'Warrior', 'Master', 'Legend'];
            
            // Update level, rank, and class
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('rank').textContent = stageNames[stage - 1];
            document.getElementById('class').textContent = gameState.class;
            generateAvatar(gameState.level);
            updateXPBar();
            renderQuests();
        }

        // Update XP Bar
        function updateXPBar() {
            const percentage = (gameState.xp / gameState.xpNeeded) * 100;
            document.getElementById('xp-fill').style.width = percentage + '%';
            document.getElementById('xp-text').textContent = `${gameState.xp} / ${gameState.xpNeeded}`;
        }

        // Render Quests
        function renderQuests() {
            renderQuestList('daily-quests', gameState.dailyQuests, 'daily');
            renderQuestList('weekly-quests', gameState.weeklyQuests, 'weekly');
        }

        function renderQuestList(containerId, quests, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = quests.map(quest => `
                <div class="quest-item ${quest.completed ? 'completed' : ''}" data-quest-id="${quest.id}">
                    <div class="quest-checkbox"></div>
                    <div class="quest-content">
                        <div class="quest-title">${quest.title}</div>
                    </div>
                    <div class="quest-reward">+${quest.xp} XP</div>
                    <div class="quest-actions">
                        <button class="quest-delete" onclick="deleteQuest('${quest.id}', '${type}')" title="Remove quest">√ó</button>
                    </div>
                </div>
            `).join('');

            container.querySelectorAll('.quest-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (!e.target.closest('.quest-actions')) {
                        toggleQuest(item.dataset.questId);
                    }
                });
            });
        }

        // Toggle Quest
        function toggleQuest(questId) {
            const quest = [...gameState.dailyQuests, ...gameState.weeklyQuests]
                .find(q => q.id === questId);
            
            if (!quest) return;

            const wasCompleted = quest.completed;
            quest.completed = !quest.completed;
            
            if (quest.completed) {
                addXP(quest.xp);
            } else {
                gameState.xp = Math.max(0, gameState.xp - quest.xp);
                updateXPBar();
            }
            
            renderQuests();
            saveGameState();
        }

        // Add XP
        function addXP(amount) {
            gameState.xp += amount;
            
            if (gameState.xp >= gameState.xpNeeded) {
                levelUp();
            }
            
            updateXPBar();
        }

        // Level Up
        function levelUp() {
            gameState.level++;
            gameState.xp -= gameState.xpNeeded;
            gameState.xpNeeded = Math.floor(gameState.xpNeeded * 1.5);
            
            celebrate('levelup');
            
            // Check for evolution rewards at milestone levels
            checkEvolutionReward(gameState.level);
            
            if (gameState.xp >= gameState.xpNeeded) {
                levelUp();
            }
        }

        // Celebrate
        function celebrate(type) {
            const celebration = document.getElementById('celebration');
            const title = document.getElementById('celebration-title');
            const message = document.getElementById('celebration-message');
            
            if (type === 'levelup') {
                title.textContent = `Level ${gameState.level}! üéâ`;
                let msg = messages.levelUp[Math.floor(Math.random() * messages.levelUp.length)];
                msg = msg.replace('{level}', gameState.level);
                
                if (messages.milestones[gameState.level]) {
                    msg += ' ' + messages.milestones[gameState.level];
                }
                
                message.textContent = msg;
                createConfetti();
            }
            
            celebration.classList.add('active');
            saveGameState();
        }

        // Create Confetti
        function createConfetti() {
            const colors = ['#3b82f6', '#60a5fa', '#06b6d4', '#10b981', '#8b5cf6'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }

        // Close Celebration
        document.getElementById('celebration-close').addEventListener('click', () => {
            document.getElementById('celebration').classList.remove('active');
            renderQuestScreen();
        });

        // Evolution Intro Modal
        document.getElementById('evolution-intro-close').addEventListener('click', () => {
            document.getElementById('evolution-intro').classList.remove('active');
            localStorage.setItem('questing_seen_intro', 'true');
        });

        // Show evolution intro on first visit to quest screen
        function showEvolutionIntro() {
            const hasSeenIntro = localStorage.getItem('questing_seen_intro');
            if (!hasSeenIntro) {
                setTimeout(() => {
                    document.getElementById('evolution-intro').classList.add('active');
                }, 500); // Small delay for smooth transition
            }
        }

        // Quest Modal Variables
        let currentEditType = null;

        /* Edit Quest function no longer needed - users can delete and re-add
        function editQuest(questId, type) {
            const quests = type === 'daily' ? gameState.dailyQuests : gameState.weeklyQuests;
            const quest = quests.find(q => q.id === questId);
            
            if (!quest) return;
            
            currentEditQuest = quest;
            currentEditType = type;
            
            document.getElementById('modal-title').textContent = 'Edit Quest';
            document.getElementById('quest-title-input').value = quest.title;
            document.getElementById('quest-xp-input').value = quest.xp;
            
            // Show XP input field for editing
            const xpGroup = document.getElementById('quest-xp-input').parentElement;
            xpGroup.style.display = 'block';
            
            document.getElementById('quest-modal').classList.add('active');
        }
        */

        // Delete Quest
        let pendingDeleteQuest = null;
        
        function deleteQuest(questId, type) {
            // Store quest info for confirmation
            pendingDeleteQuest = { questId, type };
            
            // Show confirmation modal
            document.getElementById('delete-quest-modal').classList.add('active');
        }
        
        function confirmDeleteQuest() {
            if (!pendingDeleteQuest) return;
            
            const { questId, type } = pendingDeleteQuest;
            
            if (type === 'daily') {
                gameState.dailyQuests = gameState.dailyQuests.filter(q => q.id !== questId);
            } else {
                gameState.weeklyQuests = gameState.weeklyQuests.filter(q => q.id !== questId);
            }
            
            saveGameState();
            renderQuests();
            
            // Close modal and clear pending
            document.getElementById('delete-quest-modal').classList.remove('active');
            pendingDeleteQuest = null;
        }

        // Add New Quest
        function addNewQuest(type) {
            currentEditType = type;
            
            document.getElementById('modal-title').textContent = 'Add Custom Quest';
            document.getElementById('quest-title-input').value = '';
            
            // Pre-assign XP and hide the XP input field
            const xpInput = document.getElementById('quest-xp-input');
            const xpGroup = xpInput.parentElement;
            xpGroup.style.display = 'none';
            xpInput.value = type === 'daily' ? '20' : '80';
            
            document.getElementById('quest-modal').classList.add('active');
        }

        // Modal Save
        document.getElementById('modal-save').addEventListener('click', () => {
            const title = document.getElementById('quest-title-input').value.trim();
            const xp = parseInt(document.getElementById('quest-xp-input').value);
            
            if (!title) {
                alert('Please enter a quest title.');
                return;
            }
            
            if (!xp || xp < 1) {
                alert('Please enter a valid XP amount.');
                return;
            }
            
            // Adding new quest
            const newQuest = {
                id: `${currentEditType}-custom-${Date.now()}`,
                title: title,
                xp: xp,
                completed: false,
                type: currentEditType
            };
            
            if (currentEditType === 'daily') {
                gameState.dailyQuests.push(newQuest);
            } else {
                gameState.weeklyQuests.push(newQuest);
            }
            
            saveGameState();
            renderQuests();
            document.getElementById('quest-modal').classList.remove('active');
        });

        // Modal Cancel
        document.getElementById('modal-cancel').addEventListener('click', () => {
            document.getElementById('quest-modal').classList.remove('active');
            // Reset XP field display
            document.getElementById('quest-xp-input').parentElement.style.display = 'block';
        });

        // Close modal on outside click
        document.getElementById('quest-modal').addEventListener('click', (e) => {
            if (e.target.id === 'quest-modal') {
                document.getElementById('quest-modal').classList.remove('active');
                // Reset XP field display
                document.getElementById('quest-xp-input').parentElement.style.display = 'block';
            }
        });

        // Open Rewards Modal Function
        function openRewardsModal() {
            // Populate current rewards
            document.getElementById('reward-stage2').value = gameState.rewards.stage2 || '';
            document.getElementById('reward-stage3').value = gameState.rewards.stage3 || '';
            document.getElementById('reward-stage4').value = gameState.rewards.stage4 || '';
            document.getElementById('reward-stage5').value = gameState.rewards.stage5 || '';
            
            // Update status indicators and styling
            const statuses = {
                2: document.getElementById('reward-status-2'),
                3: document.getElementById('reward-status-3'),
                4: document.getElementById('reward-status-4'),
                5: document.getElementById('reward-status-5')
            };
            
            const inputs = {
                2: document.getElementById('reward-stage2'),
                3: document.getElementById('reward-stage3'),
                4: document.getElementById('reward-stage4'),
                5: document.getElementById('reward-stage5')
            };
            
            const stages = ['stage2', 'stage3', 'stage4', 'stage5'];
            const levels = [5, 10, 15, 20];
            
            stages.forEach((stage, index) => {
                const statusSpan = statuses[index + 2];
                const input = inputs[index + 2];
                const requiredLevel = levels[index];
                
                // Remove all status classes
                input.classList.remove('reward-unlocked', 'reward-ready');
                
                if (gameState.claimedRewards.includes(stage)) {
                    statusSpan.textContent = '‚úÖ UNLOCKED! ';
                    statusSpan.style.color = 'var(--color-secondary)';
                    input.classList.add('reward-unlocked');
                } else if (gameState.level >= requiredLevel) {
                    statusSpan.textContent = 'üéâ READY! ';
                    statusSpan.style.color = 'var(--color-warning)';
                    input.classList.add('reward-ready');
                } else {
                    statusSpan.textContent = 'üîí ';
                    statusSpan.style.color = 'var(--color-text-muted)';
                }
            });
            
            document.getElementById('rewards-modal').classList.add('active');
        }

        // Set Rewards button
        document.getElementById('set-rewards-btn').addEventListener('click', openRewardsModal);

        // Rewards Save
        document.getElementById('rewards-save').addEventListener('click', () => {
            gameState.rewards.stage2 = document.getElementById('reward-stage2').value.trim();
            gameState.rewards.stage3 = document.getElementById('reward-stage3').value.trim();
            gameState.rewards.stage4 = document.getElementById('reward-stage4').value.trim();
            gameState.rewards.stage5 = document.getElementById('reward-stage5').value.trim();
            
            saveGameState();
            document.getElementById('rewards-modal').classList.remove('active');
        });

        // Rewards Cancel
        document.getElementById('rewards-cancel').addEventListener('click', () => {
            document.getElementById('rewards-modal').classList.remove('active');
        });

        // Close rewards modal on outside click
        document.getElementById('rewards-modal').addEventListener('click', (e) => {
            if (e.target.id === 'rewards-modal') {
                document.getElementById('rewards-modal').classList.remove('active');
            }
        });

        // Reward Claim Close
        document.getElementById('reward-claim-close').addEventListener('click', () => {
            document.getElementById('reward-claim-modal').classList.remove('active');
        });

        // Close reward claim modal on outside click
        document.getElementById('reward-claim-modal').addEventListener('click', (e) => {
            if (e.target.id === 'reward-claim-modal') {
                document.getElementById('reward-claim-modal').classList.remove('active');
            }
        });

        // Check for Evolution Reward
        function checkEvolutionReward(newLevel) {
            let rewardStage = null;
            let rewardText = '';
            
            if (newLevel === 5 && !gameState.claimedRewards.includes('stage2')) {
                rewardStage = 'stage2';
                rewardText = gameState.rewards.stage2;
            } else if (newLevel === 10 && !gameState.claimedRewards.includes('stage3')) {
                rewardStage = 'stage3';
                rewardText = gameState.rewards.stage3;
            } else if (newLevel === 15 && !gameState.claimedRewards.includes('stage4')) {
                rewardStage = 'stage4';
                rewardText = gameState.rewards.stage4;
            } else if (newLevel === 20 && !gameState.claimedRewards.includes('stage5')) {
                rewardStage = 'stage5';
                rewardText = gameState.rewards.stage5;
            }
            
            if (rewardStage && rewardText) {
                gameState.claimedRewards.push(rewardStage);
                saveGameState();
                
                setTimeout(() => {
                    document.getElementById('reward-claim-text').textContent = rewardText;
                    document.getElementById('reward-claim-modal').classList.add('active');
                }, 1500); // Show after level up celebration
            }
        }

        // Reset Journey - Show Confirmation Modal
        document.getElementById('reset-journey').addEventListener('click', () => {
            document.getElementById('reset-confirm-modal').classList.add('active');
        });

        // Reset Confirm
        document.getElementById('reset-confirm').addEventListener('click', () => {
            localStorage.removeItem('questing_state');
            localStorage.removeItem('questing_seen_intro');
            window.location.reload();
        });

        // Reset Cancel
        document.getElementById('reset-cancel').addEventListener('click', () => {
            document.getElementById('reset-confirm-modal').classList.remove('active');
        });

        // Close reset modal on outside click
        document.getElementById('reset-confirm-modal').addEventListener('click', (e) => {
            if (e.target.id === 'reset-confirm-modal') {
                document.getElementById('reset-confirm-modal').classList.remove('active');
            }
        });

        // Delete Quest Modal - Yes button
        document.getElementById('delete-quest-yes').addEventListener('click', () => {
            confirmDeleteQuest();
        });

        // Delete Quest Modal - No button
        document.getElementById('delete-quest-no').addEventListener('click', () => {
            document.getElementById('delete-quest-modal').classList.remove('active');
            pendingDeleteQuest = null;
        });

        // Close delete quest modal on outside click
        document.getElementById('delete-quest-modal').addEventListener('click', (e) => {
            if (e.target.id === 'delete-quest-modal') {
                document.getElementById('delete-quest-modal').classList.remove('active');
                pendingDeleteQuest = null;
            }
        });

        // Initialize
        createStars();
        if (loadGameState()) {
            showScreen('quest-screen');
            renderQuestScreen();
        }
        
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js', {
                    scope: './'
                })
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>